#!/bin/bash
source ~/.config/wpdevmanager/config

function create {
	echo -e "\ncreating wordpress site: $SITENAME at $SRVROOT"
	ssh "$USER@$IP" bash -c "'
		
		cd $SRVROOT

		if [ -d $SITENAME ]; then
			echo "Wordpress site with that name already exists!"
			echo "exiting..."
			exit
		fi

		echo "downloading Wordpress..."

		mysqladmin -uroot create "wordpress_$SITENAME"

		mkdir -p $SITENAME && cd $SITENAME

		exec wp core download | echo "configuring Wordpress..."
		exec wp core config --dbhost=localhost --dbname="wordpress_$SITENAME" --dbuser="root" --dbpass="" | echo "running Wordpress install..."
		exec wp core install --url=$IP/$SITENAME --title="$SITENAME" --admin_name=cahweb --admin_password=cahweb --admin_email=cahweb@gmail.com
	'"

	#ssh "$USER@$IP" 'exec wp core install --url=$IP/$SITENAME --title="$SITENAME" --admin_name=cahweb --admin_password=cahweb --admin_email=cahweb@gmail.com'
}

function remove {

	ssh ssh "$USER@$IP" bash -c "'
		mysqladmin -uroot drop wordpress_$SITENAME && rm -r $SITENAME

	'"
}

while getopts "c:r:" opt; do
  case $opt in
    c)
		SITENAME=$OPTARG
    	create
      	;;
    r)
		SITENAME=$OPTARG

		echo -n "are you sure you want to remove the Wordpress site: $SITENAME? (y/N): " 
		read check

		if [ ${check,,} == 'y' ]; then
			echo "exiting..."

		else {
			echo "exiting..."
			exit
		}
		fi

    	remove
      	;;
		
  esac
done